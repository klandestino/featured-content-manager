var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var r=t,n=[],i=!0,t=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done)&&(n.push(s.value),!r||n.length!==r);i=!0);}catch(e){t=!0,a=e}finally{try{!i&&o.return&&o.return()}finally{if(t)throw a}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=(()=>{function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}})();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(g=>{g.customize.FeaturedAreaControl=g.customize.Control.extend({ready:function(){var r=this,t=this.container[0],n=t.querySelector("ol.nested-sortable"),e=t.querySelectorAll(".add-featured-item"),i=t.querySelector(".clear-overflow"),a=g.i18n,s=a.__,l=void 0,o=void 0,c=void 0,u=void 0,d=void 0,f=void 0,h=(_createClass(v,[{key:"isFeaturedItemObject",value:function(e){return e.hasOwnProperty("id")&&e.hasOwnProperty("title")&&e.hasOwnProperty("id")}},{key:"addItem",value:function(){var e,t=this,r=g.template("featured-item")(this.data),r=(this.element=(r=r,e=document.createElement("template"),r=r.trim(),e.innerHTML=r,e.content.firstChild),this.element.querySelector(".button-link-delete").addEventListener("click",function(e){return t.deleteItem(e)}),this.element.querySelector(".featured-item-add").addEventListener("click",function(e){return t.cloneItem(e)}),this.element.querySelector(".handle").addEventListener("click",function(){Array.isArray(JSON.parse(n.dataset.settings))||t.element.classList.toggle("open")}),this.addSettings(this.element),this.element.querySelector(".nested-sortable"));l.initSortable(r),(void 0!==this.parent&&1<n.dataset.levels?this.list.querySelector('[data-id="'+this.parent+'"] ol'):this.list).appendChild(this.element),"object"===_typeof(this.data.children)&&this.data.children.forEach(function(e){new v(e,t.list,t.data.id)})}},{key:"addSettings",value:function(r){var s=this,e=JSON.parse(n.dataset.settings),o=this.data;Object.keys(e).forEach(function(t){var n,i=e[t],a=t;"select"===i.type&&(n=document.createElement("select"),Object.keys(i.values).forEach(function(e){var t=i.values[e],r=document.createElement("option");r.value=e,r.text=t,r.selected=o[a]===e,n.appendChild(r)}),void 0!==o[a]&&(r.dataset[t]=o[a]),r.querySelector(".settings").appendChild(n),r.addEventListener("change",function(e){r.dataset[t]=e.target.value,s.data[t]=e.target.value,l.setSettings()}))})}},{key:"removeItem",value:function(){this.element.remove()}},{key:"cloneItem",value:function(e){var t=new v(this.data,n);if(l.toggleSearchPanel(e),l.isDuplicate(this.data))l.addErrorNotification("This item already exist in the selected featured area."),t.removeItem();else if(l.isFull())return l.addErrorNotification("The selected featured area is full."),void t.removeItem();l.setSettings()}},{key:"deleteItem",value:function(){n.querySelector('[data-id="'+this.data.id+'"]').remove(),l.setSettings()}}]),v);function v(e,t,r){_classCallCheck(this,v),this.data=e,this.list=t,this.parent=r,this.element=null,this.isFeaturedItemObject(this.data)&&this.addItem()}_createClass(y,[{key:"setItems",value:function(t){try{t=JSON.parse(t)}catch(e){console.log(e),t=[{}]}t=t.slice(0,50);var r=[];t.forEach(function(e){null!=e&&r.push(parseInt(e.id))}),this.featuredAreaItems=r}},{key:"open",value:function(e){document.querySelector("body").classList.add("adding-featured-items"),this.active=!0,this.setItems(e),this.search("")}},{key:"close",value:function(){document.querySelector("body").classList.remove("adding-featured-items"),this.active=!1,this.clear()}},{key:"toggle",value:function(e){document.querySelector("body").classList.contains("adding-featured-items")?this.close():this.open(e)}},{key:"clear",value:function(){this.active=!1,document.getElementById("featured-items-search-input").value=""}},{key:"onInputChange",value:function(e){e.preventDefault();e=e.target.value;this.search(e)}},{key:"search",value:function(r){var n=this;this.active&&(clearTimeout(c),c=setTimeout(function(){var t=document.querySelector("body"),e=(t.classList.add("searching"),n.searchResult.querySelectorAll(".featured-item-tpl"));[].forEach.call(e,function(e){e.remove()}),window.fetch(wpApiSettings.root+wpFeaturedContentApiSettings.base+"posts",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-WP-Nonce":wpApiSettings.nonce},body:JSON.stringify({s:r,type:d,subtype:f,list:n.featuredArea,items:n.featuredAreaItems}),credentials:"same-origin"}).then(function(e){return e.json()}).then(function(e){t.classList.remove("searching"),e.forEach(function(e,t){new h(e,n.searchResult)})})},500))}}]);var m=y;function y(e){var t=this;_classCallCheck(this,y),this.featuredArea=e,this.featuredAreaItems=[],this.active=!0,this.searchResult=document.getElementById("featured-items-search-list"),this.search(""),document.getElementById("featured-items-search-input").addEventListener("keyup",function(e){return t.onInputChange(e)}),document.addEventListener("click",function(e){e.target.classList.contains("add-featured-item")||function e(t,r){if(!t.parentNode)return!1;if(0<=t.className.split(" ").indexOf(r))return!0;return e(t.parentNode,r)}(e.target,"featured-item-container")||t.close()}),document.querySelector("#featured-items-search-panel .customize-section-back").addEventListener("click",function(e){return t.close()})}function p(){var t=this;_classCallCheck(this,p),this.nestedSortables=[],u=n.dataset.max,d=n.dataset.type,f=n.dataset.subtype.split(","),e.forEach(function(e){e.addEventListener("click",function(e){return t.toggleSearchPanel(e)})}),i.addEventListener("click",function(e){return t.clearOverflow(e)})}_createClass(p,[{key:"loadSettings",value:function(){var t=r.setting.get();try{t=JSON.parse(t)}catch(e){console.log(e),t=[{}]}(t=t.slice(0,50)).forEach(function(e){null!=e&&new h(e,n)}),this.toggleClearOverflow(),this.initSortables()}},{key:"getDataAttributes",value:function(r){return Object.keys(r).reduce(function(e,t){return e[t]=r[t],e},{})}},{key:"setSettings",value:function(){var t=this;clearTimeout(o),this.toggleClearOverflow(),o=setTimeout(function(){var e=t.serialize(n);r.setting.set(JSON.stringify(e)),g.customize.previewer.refresh()},500)}},{key:"serialize",value:function(e){var t,r=[],n=[].slice.call(e.children);for(t in n){var i=n[t].querySelector(".nested-sortable"),a=this.getDataAttributes(n[t].dataset);r.push(_extends({},a,{children:i?this.serialize(i):[]}))}return r}},{key:"isDuplicate",value:function(e){var t=!1;return t=1<n.querySelectorAll('[data-id="'+e.id+'"]').length?!0:t}},{key:"isFull",value:function(){var e=n.querySelectorAll(".featured-item-tpl");return u<e.length}},{key:"toggleSearchPanel",value:function(e){e.preventDefault(),this.searchPanel||(this.searchPanel=new m(n.id)),this.searchPanel.toggle(r.setting.get())}},{key:"toggleClearOverflow",value:function(){this.isFull()?i.classList.remove("hidden"):i.classList.add("hidden")}},{key:"clearOverflow",value:function(e){var t=this;e.preventDefault(),[].slice.call(n.querySelectorAll(".featured-item-tpl")).splice(u).forEach(function(e){e.remove(),t.setSettings()})}},{key:"initSortables",value:function(){var e=t.querySelector(".featured-area"),e=(this.initSortable(e),document.querySelector("#featured-items-search-list"));this.initSortable(e,{group:{name:"nested",put:!1},animation:150,sort:!1})}},{key:"initSortable",value:function(e){var t=this;new Sortable(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{group:"nested",swapThreshold:.65,emptyInsertThreshold:5,animation:150,onSort:function(e){t.setSettings()},onAdd:function(e){t.isDuplicate(e.clone.dataset)&&(e.item.remove(),t.addErrorNotification("This item already exist in the selected featured area."))}})}},{key:"addErrorNotification",value:function(e){g.customize.notifications.add("error",new g.customize.Notification("error",{dismissible:!0,message:s(e,"featured-content-manager"),type:"error"}))}}]),(l=new p).loadSettings()}}),_.extend(g.customize.controlConstructor,{"featured-area":g.customize.FeaturedAreaControl})})(wp,jQuery),(r=>{var e=wpFeaturedContentApiSettings.go_to_urls,t=!0,n=!1,i=void 0;try{for(var a,s=Object.entries(e)[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var o=_slicedToArray(a.value,2);((e,t)=>{r.section(e,function(e){e.expanded.bind(function(e){e?r.previewer.previewUrl.set(r.settings.url.home+t):r.previewer.previewUrl.set(r.settings.url.home)})})})(o[0],o[1])}}catch(e){n=!0,i=e}finally{try{!t&&s.return&&s.return()}finally{if(n)throw i}}})(wp.customize);